autotest:
  enabled: true
  schedule:
    day_of_week: 6  # 0=Monday, 6=Sunday
    start_hour: 2   # 2 AM
    end_hour: 4     # 4 AM
    timezone: "America/Denver"  # Salt Lake City (Mountain Time)
  
  training:
    num_models_to_train: 20  # Total models (used only if training_strategy.yaml missing)
    base_timesteps: 3000000  # Default timesteps for new models (increased for grokking)
    
    # Parameter variations for training - PPO and SAC
    algorithms:
      - ppo  # 60% - Stable, diverse trading behavior
      - sac  # 40% - Sample efficient, concentrated positions
    
    # Organized stock baskets by sector (round-robin selection for diversity)
    # Each basket has 8-10 stocks for better diversification
    # Target: 35-42 stocks per model for optimal data density (~1:40-1:50 ratio)
    stock_baskets:
      tech_mega_large:
        name: "Tech Megacaps Large"
        tickers: ["AAPL", "MSFT", "GOOGL", "AMZN", "META", "NVDA", "TSLA", "NFLX", "CRM", "ADBE"]
      tech_semis_large:
        name: "Semiconductors Large"
        tickers: ["NVDA", "AMD", "INTC", "AVGO", "QCOM", "TXN", "MU", "LRCX", "KLAC", "MRVL"]
      tech_software:
        name: "Enterprise Software"
        tickers: ["MSFT", "CRM", "NOW", "ADBE", "INTU", "SNOW", "PLTR", "PANW", "FTNT", "CRWD"]
      financials_large:
        name: "Financials Large"
        tickers: ["JPM", "BAC", "WFC", "GS", "MS", "C", "BLK", "AXP", "USB", "PNC"]
      healthcare_large:
        name: "Healthcare Large"
        tickers: ["JNJ", "UNH", "PFE", "ABBV", "MRK", "LLY", "TMO", "ABT", "DHR", "BMY"]
      consumer_large:
        name: "Consumer Large"
        tickers: ["AMZN", "HD", "NKE", "MCD", "SBUX", "COST", "LOW", "TJX", "F", "GM"]
      industrials:
        name: "Industrials"
        tickers: ["CAT", "GE", "HON", "UPS", "BA", "RTX", "LMT", "DE", "MMM", "UNP"]
      energy_materials:
        name: "Energy & Materials"
        tickers: ["XOM", "CVX", "COP", "SLB", "EOG", "FCX", "NEM", "DOW", "APD", "LIN"]
      communications:
        name: "Communications"
        tickers: ["GOOGL", "META", "NFLX", "DIS", "CMCSA", "VZ", "T", "TMUS", "CHTR", "WBD"]
      etf_broad:
        name: "Broad ETFs"
        tickers: ["SPY", "QQQ", "DIA", "IWM", "VTI", "VOO", "IVV", "VEA", "VWO", "BND"]
      etf_sector:
        name: "Sector ETFs"
        tickers: ["XLK", "XLF", "XLE", "XLV", "XLI", "XLP", "XLY", "XLB", "XLU", "XLRE"]
      # Hedging & Alternative baskets
      metals_commodities:
        name: "Metals & Commodities"
        tickers: ["GLD", "SLV", "IAU", "PPLT", "GDX", "GDXJ", "USO", "UNG", "DBA", "WOOD"]
      fixed_income:
        name: "Fixed Income"
        tickers: ["TLT", "IEF", "SHY", "LQD", "HYG", "TIP", "BND", "AGG", "VGIT", "VCLT"]
      safe_haven_mix:
        name: "Safe Haven Mix"
        tickers: ["GLD", "TLT", "VXX", "UUP", "SPLV", "USMV", "PFF", "VNQ", "REM", "SHV"]
      international:
        name: "International Developed"
        tickers: ["VEA", "IEFA", "VXUS", "VEU", "SPDW", "EFA", "IEMG", "VWO", "SCZ", "EFAV"]
    
    learning_rate_variations:
      - 0.0001
      - 0.0003
      - 0.0005
      - 0.001
      - 0.002
    
    # PPO-specific hyperparameters
    n_steps_variations:
      - 1024
      - 2048
      - 4096
    
    batch_size_variations:
      - 32
      - 64
      - 128
    
    gamma_variations:
      - 0.95
      - 0.99
      - 0.995
    
    clip_range_variations:
      - 0.1  # Tighter clipping prevents large destructive updates
    
    # Weight decay (L2 regularization) to prevent memorization
    weight_decay_variations:
      - 0.00001  # 1e-5 L2 regularization
    
    # Network architecture variations (pi and vf networks)
    net_arch_variations:
      - [[128, 64], [128, 64]]        # Smaller, faster
      - [[256, 128], [256, 128]]      # Default balanced
      - [[512, 256], [512, 256]]      # Larger capacity
      - [[256, 256, 128], [256, 256, 128]]  # Deeper network
    
    # SAC-specific hyperparameters
    sac_buffer_size_variations:
      - 500000
      - 1000000
    
    sac_batch_size_variations:
      - 128
      - 256
      - 512
    
    sac_tau_variations:  # Soft update coefficient
      - 0.005
      - 0.01
    
    sac_train_freq_variations:
      - 1
      - 4
    
    # Algorithm selection weights (for random selection)
    algorithm_weights:
      ppo: 0.6   # 60% PPO models
      sac: 0.4   # 40% SAC models
    
  backtesting:
    test_period_days: 90  # Days of historical data to backtest
    metrics_to_evaluate:
      - sharpe_ratio
      - total_return
      - max_drawdown
      - win_rate
      - sortino_ratio
    
    # Weights for ranking models (higher = more important)
    ranking_weights:
      sharpe_ratio: 0.35
      total_return: 0.25
      max_drawdown: 0.20  # Lower is better, will be inverted
      win_rate: 0.10
      sortino_ratio: 0.10
    
    top_n_models: 5  # Number of top models to paper trade
  
  paper_trading:
    duration_hours: 6.5  # Trading hours (9:30 AM - 4:00 PM EST)
    check_interval: 300  # Check every 5 minutes
    initial_capital: 100000
    max_position_size: 0.15
    stop_loss_pct: 0.03
  
  # Colosseum - Continuous model lifecycle management
  colosseum:
    enabled: true
    max_paper_trading_models: 10  # Maximum models in paper trading at once (Alpaca allows unlimited)
    min_paper_trading_days: 20   # Minimum 4 weeks (20 trading days) before culling
    cull_threshold_vs_backtest: 0.5  # Cull if return < 50% of backtest expectation
    cull_loss_threshold: -0.05   # Cull if cumulative loss > 5%
    promote_return_threshold: 0.05  # Promote if return > 5%
    promote_sharpe_threshold: 0.5   # Promote if Sharpe > 0.5
    promote_min_days: 40         # Minimum days before promotion eligible (8 weeks)
    
    # Backtest quality gate - models must pass to enter VALIDATION
    backtest_quality_gate:
      min_sharpe_ratio: 0.3      # Minimum Sharpe ratio to pass
      min_total_return: 0.0      # Minimum return (0 = must be profitable)
      max_drawdown: 0.25         # Maximum drawdown allowed (25%)
    
    # Grokking gate - verify models have genuinely learned before paper trading
    # Uses weight matrix spectral analysis + eval curve phase detection
    # to distinguish real learning from memorization of training data
    grokking_gate:
      enabled: true              # Set to false to skip grokking checks
    
    # Schedule for continuous operation
    daily_training_limit: 5      # Max models to train per day
    training_hour: 2             # 2 AM (daily)
    max_eligible_for_training: 5 # Skip training if 5+ models eligible for paper trading
    culling_day: 5               # Saturday
    culling_hour: 18             # 6 PM
    
    # Daily paper trading schedule (market hours)
    market_open_hour: 7          # 7:30 AM Mountain = 9:30 AM Eastern
    market_close_hour: 14        # 2:00 PM Mountain = 4:00 PM Eastern
    
    # Circuit breaker - cull models immediately if they hit catastrophic loss
    # during paper trading, instead of waiting for Saturday culling cycle
    circuit_breaker_loss: -0.10     # Cull if cumulative loss exceeds 10%
    circuit_breaker_sharpe: -1.5    # Cull if Sharpe drops below -1.5 (after 5+ days)
    
    # Genetic evolution - spawn offspring from elite performers
    genetic_training:
      enabled: true
      offspring_ratio: 0.4       # 40% offspring from elite parents, 60% fresh models
      offspring_timesteps: 500000  # Additional training for offspring
      offspring_lr_multiplier: 0.3  # Lower learning rate for fine-tuning
      min_parent_trading_days: 15  # Parent must have 15+ days (3 weeks) of paper trading data
    
  storage:
    models_dir: "autotest_models"
    results_dir: "autotest_results"
    logs_dir: "autotest_logs"
    strategy_db: "autotest_strategies.db"  # SQLite database for strategy tracking
    keep_history_days: 90  # Keep results for 90 days (3 months of weekly runs)
  
  strategy_tracking:
    enabled: true
    track_metrics:
      - sharpe_ratio
      - total_return
      - max_drawdown
      - win_rate
      - sortino_ratio
      - calmar_ratio
      - volatility
    compare_weeks: 12  # Compare against last 12 weeks
    identify_patterns: true  # Analyze which parameter combinations work best
    save_best_strategies: true  # Keep archive of best performing strategies
  
  notifications:
    enabled: false
    email: ""  # Add email for notifications
    slack_webhook: ""  # Add Slack webhook URL
